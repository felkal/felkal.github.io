<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fuzzware Utils</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Documentation</a></li><li class="chapter-item expanded "><a href="coverage_analysis.html"><strong aria-hidden="true">1.</strong> Coverage Analysis</a></li><li class="chapter-item expanded "><a href="crash_analysis.html"><strong aria-hidden="true">2.</strong> Crash Analysis</a></li><li class="chapter-item expanded "><a href="fuzzware_utils.html" class="active"><strong aria-hidden="true">3.</strong> Fuzzware Utils</a></li><li class="chapter-item expanded "><a href="manipulating_inputs.html"><strong aria-hidden="true">4.</strong> Manipulating Inputs</a></li><li class="chapter-item expanded "><a href="target_configuration.html"><strong aria-hidden="true">5.</strong> Target Configuration</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/fuzzware-fuzzer/fuzzware" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fuzzware-utilities"><a class="header" href="#fuzzware-utilities">Fuzzware Utilities</a></h1>
<p>Here we go into some of Fuzzware's utilities. Note that some of this duplicates with the other READMEs and not all utilities are covered exhaustively. For help on the different components of fuzzware, use the <code>fuzzware -h</code> command.</p>
<p>Running fuzzware typically means running the pipeline component (command <code>&quot;fuzzware pipeline&quot;</code> in a configured directory) which performs the job of fuzzing, looking at interesting traces and updating the emulator (with MMIO models) on the fly. Fuzzware will create a <code>fuzzware-project</code> directory next to your firmware image containing all the data upon which it operates.</p>
<p>To make sense of pipeline results (contents of a <code>fuzzware-project</code> directory), additional fuzzware utilities are used. Manual tasks on pipeline results include finding input files which trigger certain behaviors (<code>fuzzware cov</code>), analyzing firmware behavior for a specific crashing or non-crashing input (<code>fuzzware replay</code>). These other utilities are introduced later in this document.</p>
<p>Before trying to run fuzzware, make sure that everything has been installed <em>and that you are in the correct virtualenv</em> in case you are using a local setup rather than in docker. When fuzzing is involved, also make sure your system is set up for afl to agree with its environment (as root, on host):</p>
<pre><code>echo core &gt;/proc/sys/kernel/core_pattern
cd /sys/devices/system/cpu
echo performance | tee cpu*/cpufreq/scaling_governor
</code></pre>
<p>When running fuzzware directly on a host system, make sure to also execute everything in a virtualenv:</p>
<pre><code>workon fuzzware
</code></pre>
<h2 id="starting-the-pipeline"><a class="header" href="#starting-the-pipeline">Starting the Pipeline</a></h2>
<p>The pipeline is what you want to be using whenever you start fuzzing a firmware image as it automatically manages fuzzing and model generation for you. It will generate the configurations and inputs that you can use to perform manual triaging and troubleshooting.</p>
<p>For a properly configured firmware image and when within the installed <code>fuzzware</code> docker container or the <code>fuzzware</code> virtualenv on your locally installed system, you can get started by simply navigating to a correctly configured target directory in <a href="examples">the examples subdirectory</a> and starting the pipeline with default arguments:</p>
<p>Using Docker:</p>
<pre><code>./run_docker.sh ./examples fuzzware pipeline ./pw-recovery/ARCH_PRO
</code></pre>
<p>On your local host setup:</p>
<pre><code>workon fuzzware &amp;&amp; fuzzware pipeline ./examples/pw-recovery/ARCH_PRO
</code></pre>
<p>This will create a <code>fuzzware-project</code> subdirectory and start the full pipeline which handles fuzzing, modeling and configuration migrations automatically. The fuzzing results will be written to <code>examples/pw-recovery/ARCH_PRO/fuzzware-project</code> in both of the above cases:</p>
<ul>
<li><code>fuzzware-project/mainXXX</code>: Emulator configuration iterations</li>
<li><code>fuzzware-project/mainXXX/fuzzers/fuzzerY</code>: Fuzzer directory for the given configuration</li>
<li><code>fuzzware-project/mainXXX/fuzzers/fuzzerY/queue</code>: Fuzzer inputs</li>
<li><code>fuzzware-project/mainXXX/fuzzers/fuzzerY/traces</code>: Pipeline-generated compact traces (detailed traces can be generated manually using <code>fuzzware replay</code> or <code>fuzzware emu</code>)</li>
</ul>
<p>For more information on the results stored in the <code>fuzzware-project</code> directory, refer to the pipeline's README <a href="pipeline/README.html">pipeline/README.md</a>.</p>
<p>There are situations where you might want to use a sub-component in isolation. This may be the case for troubleshooting, debugging, crash triaging and during fuzzware development. For a full list of supported commands, use:</p>
<pre><code>fuzzware -h
</code></pre>
<h2 id="coverage-analysis"><a class="header" href="#coverage-analysis">Coverage Analysis</a></h2>
<p>As a means to more easily find inputs which lead to particular coverage, the <code>fuzzware cov</code> utility finds an input which contains a given basic block or symbol in its trace. This can be used to find an input to use with <code>fuzzware replay</code>.</p>
<p>To find an input file within the current project that reaches the <code>main</code> function, use:</p>
<pre><code>fuzzware cov main
</code></pre>
<p>For a full list of options:</p>
<pre><code>fuzzware cov -h
</code></pre>
<h2 id="replaying-emulation-runs"><a class="header" href="#replaying-emulation-runs">Replaying Emulation Runs</a></h2>
<p>Once the pipeline has been running for a while, you may be interested in what is actually going on in the configurations and the inputs (and maybe crashes) that it generated.</p>
<p><code>fuzzware replay</code> can be used to easily reproduce single emulation runs for a pipeline-residing input file. It is a wrapper around <code>fuzzware emu</code> which automatically locates the correct configuration file and command-line arguments for an emulator configuration iteration. It allows you to re-run the emulation of a given input as it was executed within a fuzzer instance. To help you with the correct invocation and to reduce verbosity when compared to the raw <code>fuzzware emu</code> interface, it translates trace- to corresponding input file paths and resolves numeric input ids.</p>
<p>To replay an input or an input corresponding to a trace file for the first configuration iteration, use:</p>
<pre><code># By an input file
fuzzware replay fuzzware-project/main001/fuzzers/fuzzer1/queue/id:000000*
# By a trace file
fuzzware replay fuzzware-project/main001/fuzzers/fuzzer1/traces/bblset_id:000000*
</code></pre>
<p>To replay an input based on its id (here, the first input id <code>000000</code> is used) of the latest configuration iteration, run from within the project base directory:</p>
<pre><code>fuzzware replay 0
</code></pre>
<p>You can also replay an input by just giving its name and fuzzware will find the exact path for you, as long as the input file name is unique.</p>
<p>Finally, to save an extra invocation of <code>fuzzware cov</code> to find a suitable input file, you can also have fuzzware find an input path which covers a specific address or symbol and replay it automatically for you. To replay the first input file reaching the <code>main</code> function, use:</p>
<pre><code>fuzzware replay --covering main
</code></pre>
<p>You can provide the same additional arguments to the <code>replay</code> command as you would to the <code>emu</code> command as shown previously. Note that for projects containing multiple fuzzer instances this may become ambiguous for numeric ids. In that case, fuzzware will complain and you will need to add arguments or navigate to a deeper working directory inside the project.</p>
<p>For all replay-supported options, use:</p>
<pre><code>fuzzware replay -h
</code></pre>
<h2 id="raw-emulation-runs"><a class="header" href="#raw-emulation-runs">Raw Emulation Runs</a></h2>
<p>The following code snippets assume that your current working directory is the firmware target directory (for the <code>Getting Started</code> examples, this would be <code>examples/pw-recovery/ARCH_PRO</code>).</p>
<p>For additional debugging output for the initial input:</p>
<pre><code>fuzzware emu -c fuzzware-project/main001/config.yml --debug -t -M fuzzware-project/main001/fuzzers/fuzzer1/queue/id:000000,*
</code></pre>
<p>Re-run a crashing input to triage the crash:</p>
<pre><code>fuzzware emu -c fuzzware-project/main001/config.yml fuzzware-project/main001/fuzzers/fuzzer1/crashes/id:000000,sig:11,XXXXX
</code></pre>
<p>Setting a breakpoint on a crashing input:</p>
<pre><code>fuzzware emu -c fuzzware-project/main001/config.yml --debug -t -M --breakpoint 0x12345678 fuzzware-project/main001/fuzzers/fuzzer1/crashes/id:000000,*
</code></pre>
<p>To generate trace files for further analysis:</p>
<pre><code>fuzzware emu -c fuzzware-project/main001/config.yml --bb-trace-out=bb_trace.txt --mmio-trace-out=mmio_trace.txt --ram-trace-out=ram_trace.txt fuzzware-project/main001/fuzzers/fuzzer1/crashes/id:000000,sig:11,XXXXX
</code></pre>
<p>For all emulator-supported options, use:</p>
<pre><code>fuzzware emu -h
</code></pre>
<h2 id="raw-fuzzing"><a class="header" href="#raw-fuzzing">Raw Fuzzing</a></h2>
<p>This is likely not what you want to be doing during regular fuzzing (use <code>fuzzware pipeline</code> instead!), as no MMIO access modeling is performed and you are unable to make use of boot guidance by configuration (which is implemented by the pipeline component by inspecting traces and configuring the fuzzers to start from a valid booted state once one is found according to the configured specification).</p>
<p>That said, if you are confident in a configuration that you built or the pipeline built for you over time and which you are sure will not be updated anymore, you can also run a standalone fuzzer without modeling or other pipeline features.</p>
<p>You can run a standalone fuzzer (make sure you are in the correct virtualenv in local setups) in the following way:</p>
<pre><code># in a local setup: workon fuzzware
cd examples/pw-recovery/ARCH_PRO
fuzzware fuzz afl-output-dir
</code></pre>
<p>For a full list of options:</p>
<pre><code>fuzzware fuzz -h
</code></pre>
<h2 id="generating-statistics"><a class="header" href="#generating-statistics">Generating Statistics</a></h2>
<p>To aggregate data on a given <code>fuzzware-project</code> directory, we can use <code>fuzzware genstats</code> to generate matrics about code coverage, how much time was spent on different types of pipeline jobs, the fuzzing input consumption of different MMIO models, and on the contexts in which crashes occured:</p>
<p>For a full list of options:</p>
<pre><code>fuzzware genstats -h
</code></pre>
<h2 id="generating-traces"><a class="header" href="#generating-traces">Generating Traces</a></h2>
<p>By default, the pipeline component only generates set-based traces which are quick to compute and storage-light. However, Fuzzware's emulation component is also able to generate full traces. While taking longer to compute and taking up more disk space, these traces contain a full list of sequential trace events and can be parsed automatically. Generating such traces could be interesting for manually looking into firmware behavior or for scripting some trace-based analysis.</p>
<p>For a full list of options:</p>
<pre><code>fuzzware gentraces -h
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="crash_analysis.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="manipulating_inputs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="crash_analysis.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="manipulating_inputs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
